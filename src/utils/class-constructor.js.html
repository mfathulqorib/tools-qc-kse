<script>
  class SkuManager {
    constructor() {
      this.skuCount = 1;
      this.maxSkus = 4;
      this.skuList;
    }

    addSKU() {
      if (this.skuList && this.skuCount < this.maxSkus) {
        this.skuCount++;
        // showModalsOnLoading();

        const $listSKUPakan = $("#list-sku-pakan");
        const skuElement = this.createSKUElement(this.skuCount);
        const qtyElement = this.createQtyElement(this.skuCount);
        const qtyOpenElement = this.createQtyOpenElement(this.skuCount);
        const separatorElement = this.createSeparatorElement();

        $listSKUPakan.append(
          skuElement,
          qtyElement,
          qtyOpenElement,
          separatorElement
        );

        this.populateSkuDropdown(this.skuList, this.skuCount);
      }
    }

    createSeparatorElement() {
      const separatorContainer = $("<div>", {
        class: "ps-3 additional-element deleted-after-submit",
      });
      const separator = $("<hr>", {
        class: "hr border-3 my-2 additional-element deleted-after-submit",
      });

      separatorContainer.append(separator);

      return separatorContainer;
    }

    createSKUElement(skuCount) {
      const skuContainer = $("<div>", {
        class:
          "d-flex flex-column gap-1 ps-3 additional-element deleted-after-submit",
      });
      const skuLabel = $("<label>", {
        for: `sku-pakan-${skuCount}`,
        text: `SKU Pakan ${skuCount}`,
      });
      const skuSelect = $("<select>", {
        id: `sku-pakan-${skuCount}`,
        class: "form-select",
        name: `sku-pakan-${skuCount}`,
      });
      const defaultOption = $("<option>", {
        disabled: true,
        selected: true,
        value: "",
        text: "Pilih SKU pakan sebelum mengisi stok pakan",
      });

      skuSelect.append(defaultOption);
      skuContainer.append(skuLabel, skuSelect);

      return skuContainer;
    }

    createQtyElement(skuCount) {
      const qtyContainer = $("<div>", {
        class:
          "d-flex flex-column gap-1 ps-3 additional-element deleted-after-submit",
      });
      const qtyLabel = $("<label>", {
        for: `qty-pakan-${skuCount}`,
        text: `Stok Pakan ${skuCount} (sak)`,
      });
      const qtyInput = $("<input>", {
        id: `qty-pakan-${skuCount}`,
        name: `qty-pakan-${skuCount}`,
        class: "form-control gap-2",
        type: "number",
        min: "0",
        placeholder: "Jumlah sak utuh yang belum dibuka",
      });

      qtyContainer.append(qtyLabel, qtyInput);

      return qtyContainer;
    }

    createQtyOpenElement(skuCount) {
      const qtyOpenContainer = $("<div>", {
        class:
          "d-flex flex-column gap-1 ps-3 additional-element deleted-after-submit",
      });
      const qtyOpenLabel = $("<label>", {
        for: `qty-pakan-${skuCount}-open`,
        text: `Stok Pakan ${skuCount} (kg)`,
      });
      const qtyOpenInput = $("<input>", {
        id: `qty-pakan-${skuCount}-open`,
        name: `qty-pakan-${skuCount}-open`,
        class: "form-control",
        type: "number",
        min: "0",
        step: "0.1",
        placeholder: "Sisa kg isi sak pakan yang sudah dibuka",
      });

      qtyOpenContainer.append(qtyOpenLabel, qtyOpenInput);

      return qtyOpenContainer;
    }

    createSkuDropdown(skuCount) {
      google.script.run
        .withSuccessHandler((values) =>
          this.populateSkuDropdown(values, skuCount)
        )
        .withFailureHandler(onFailure)
        .getListSkuPakan();
    }

    populateSkuDropdown(skuList, skuCount) {
      const $skuSelect = $(`#sku-pakan-${skuCount}`);

      hideSpinnerModal();

      skuList.forEach((value) => {
        const option = $("<option>", { value, text: value });
        $skuSelect.append(option);
      });
    }
  }

  class PondManager {
    constructor() {
      this.pondCount = 1;
      this.maxPonds = 10;
      this.pondList;
      this.totalPonds;
    }

    addPond() {
      if (
        this.totalPonds &&
        this.pondCount < this.totalPonds &&
        this.pondCount < this.maxPonds
      ) {
        this.pondCount++;

        const $listKolam = $("#list-no-kolam");
        const pondElement = this.createPondElement(
          this.pondCount,
          this.pondList
        );

        $listKolam.append(pondElement);
      }
    }

    createPondElement(pondCount, pondList) {
      const pondContainer = $("<div>", {
        class:
          "d-flex flex-column gap-1 additional-element deleted-after-submit",
      });
      const pondLabel = $("<label>", {
        for: `no-kolam-${pondCount}`,
        text: `Nomor kolam`,
      });
      const pondSelect = $("<select>", {
        id: `no-kolam-${pondCount}`,
        class: "form-select",
        name: `no-kolam-${pondCount}`,
      });
      const defaultOption = $("<option>", {
        disabled: true,
        selected: true,
        value: "",
        text: "Pilih no kolam",
      });

      pondContainer.append(pondLabel, pondSelect);
      pondSelect.append(defaultOption);
      pondList.forEach((pondNumber, index) => {
        pondSelect.append(
          $("<option>", {
            value: pondNumber,
            text: pondNumber,
          })
        );
      });

      return pondContainer;
    }
  }
</script>
